#+BEGIN_SRC ipython :session
  import itertools
  import matplotlib.pyplot as plt
  import numpy as np
  import pymc3 as pm
  import scipy
  import scipy.stats as stats
  import seaborn as sns
  %matplotlib inline
#+END_SRC

#+BEGIN_SRC ipython :session :results output
  import yaha_analyzer
  nom = yaha_analyzer.yaha_analyzer()
  nom._load_collectobot_data()
  print(nom.games.head())
  print(len(nom.games['hero_deck']))
#+END_SRC

#+RESULTS:
#+begin_example
                   added                                       card_history  \
10  2016-06-28T17:57:45Z  [{'player': 'opponent', 'card': {'name': 'Tunn...   
11  2016-06-28T17:44:53Z  [{'player': 'me', 'card': {'name': 'The Coin',...   
12  2016-06-28T17:36:41Z  [{'player': 'me', 'card': {'name': 'N'Zoth's F...   
13  2016-06-28T17:28:55Z  [{'player': 'me', 'card': {'name': 'N'Zoth's F...   
14  2016-06-28T17:20:01Z  [{'player': 'opponent', 'card': {'name': 'Fier...   

     coin  duration     hero hero_deck        id  legend    mode  note  \
10   True     761.0  Warrior    Dragon  33262529     NaN  ranked  None   
11   True     349.0  Warrior    Dragon  33261034     NaN  ranked  None   
12  False     419.0  Warrior    Dragon  33260101     NaN  ranked  None   
13  False     265.0  Warrior    Dragon  33259253     NaN  ranked  None   
14  False     290.0  Warrior    Dragon  33258263     NaN  ranked  None   

   opponent opponent_deck  rank  region result  \
10   Shaman      Midrange   6.0  Europe   loss   
11   Hunter      Midrange   6.0  Europe   loss   
12    Druid        C'Thun   6.0  Europe   loss   
13  Warlock           Zoo   6.0  Europe    win   
14   Hunter      Midrange   6.0  Europe    win   

                           user_hash     p_deck_type      o_deck_type  \
10  853B97737D848AE2F22D60931C888CB3  Dragon_Warrior  Midrange_Shaman   
11  853B97737D848AE2F22D60931C888CB3  Dragon_Warrior  Midrange_Hunter   
12  853B97737D848AE2F22D60931C888CB3  Dragon_Warrior     C'Thun_Druid   
13  853B97737D848AE2F22D60931C888CB3  Dragon_Warrior      Zoo_Warlock   
14  853B97737D848AE2F22D60931C888CB3  Dragon_Warrior  Midrange_Hunter   

                                       p_cards_played  \
10  [The Coin, Fiery War Axe, Blood To Ichor, Fier...   
11  [The Coin, Alexstrasza's Champion, Fiery War A...   
12  [N'Zoth's First Mate, Slam, Blood To Ichor, Tw...   
13  [N'Zoth's First Mate, Blood To Ichor, Fiery Wa...   
14  [Fiery War Axe, Blood To Ichor, Alexstrasza's ...   

                                       o_cards_played  
10  [Tunnel Trogg, Feral Spirit, Flametongue Totem...  
11  [King's Elekk, Eaglehorn Bow, Infested Wolf, S...  
12  [Innervate, Twilight Elder, Beckoner of Evil, ...  
13  [Argent Squire, The Coin, Darkshire Councilman...  
14  [Fiery Bat, The Coin, Animal Companion, Eagleh...  
13522
#+end_example

#+BEGIN_SRC ipython :session :results output
  cards = nom.generate_card_stats(card_threshold=5)
  print(cards)
#+END_SRC

#+RESULTS:
#+begin_example
                                                           loss  win
card                   p_deck_type   o_deck_type     turn           
Abusive Sergeant       Aggro_Paladin C'Thun_Druid    8        0    3
                                     C'Thun_Warrior  4        2    1
                                     Dragon_Warrior  3        3    3
                                                     5        1    3
                                                     7        3    0
                                                     9        0    3
                                     Midrange_Hunter 2        2    1
                                                     5        2    1
                                                     6        3    3
                                     Midrange_Shaman 2        1    2
                                     Token_Druid     6        2    2
                                                     7        4    0
                                                     9        1    3
                                     Zoo_Warlock     3        2    1
                                                     4        1    2
                                                     7        3    0
                       Aggro_Shaman  Aggro_Shaman    2        2    6
                                                     3        4    6
                                                     4       10    1
                                                     5        2    3
                                                     6        2    2
                                                     7        2    5
                                                     8        0    3
                                     C'Thun_Druid    2        0    3
                                                     4        0    3
                                                     5        3    0
                                                     6        2    3
                                                     7        1    6
                                     C'Thun_Warrior  1        3    0
                                                     2        3    2
...                                                         ...  ...
Yogg-Saron, Hope's End Tempo_Mage    Zoo_Warlock     10       3    3
                       Token_Druid   C'Thun_Druid    9        2    1
                                     C'Thun_Warrior  10       3    0
                                                     12       3    1
                                                     13       5    2
                                                     14       2    1
                                     Dragon_Warrior  7        3    3
                                                     8        2    2
                                                     9        3    3
                                                     10       6    2
                                                     11       2    1
                                                     12       2    1
                                     Midrange_Hunter 9        2    2
                                                     10       4    0
                                     Other_Warrior   10       2    1
                                     Reno_Warlock    16       0    3
                                     Token_Druid     8        2    2
                                                     9        1    4
                                                     10       2    3
                                                     11       4    1
                                     Zoo_Warlock     8        1    2
Ysera                  Other_Priest  Other_Mage      9        1    2
                                     Other_Paladin   9        1    2
                                                     10       1    2
                                     Other_Warrior   14       3    0
                       Other_Warrior Other_Warrior   10       1    3
                                                     11       3    0
                                                     14       1    2
Zombie Chow            Other_Priest  Other_Mage      1        2    1
                                     Other_Warlock   19       0    3

[31122 rows x 2 columns]
#+end_example

#+BEGIN_SRC ipython :session :results output
  #card_stats = cards.reset_index()
  #stats = card_stats[card_stats['card'] == 'Fiery War Axe']
  #print(stats)
  #print(cards.loc['Fiery War Axe', 'Dragon_Warrior'])
  card_stats = cards.sum(level=['card', 'p_deck_type', 'o_deck_type']).loc['Fiery War Axe']
  #print(card_stats)
  print(cards
#+END_SRC

#+RESULTS:
#+begin_example
                                 loss  win
p_deck_type     o_deck_type               
C'Thun_Warrior  Aggro_Paladin       6    0
                Aggro_Shaman       28   31
                C'Thun_Druid        5    4
                C'Thun_Priest       3    2
                C'Thun_Warrior     21   27
                Dragon_Warrior     49   57
                Midrange_Hunter    32   36
                Midrange_Shaman    18   14
                Miracle_Rogue       7    9
                N'Zoth_Paladin      5    1
                N'Zoth_Rogue        1    2
                Other_Hunter        2    1
                Other_Shaman        2    2
                Other_Warrior       6    6
                Reno_Warlock        7    9
                Tempo_Mage         21   20
                Tempo_Warrior       5    3
                Token_Druid        28   22
                Zoo_Warlock        42   31
Control_Warrior Aggro_Shaman        9    6
                C'Thun_Warrior      6    1
                Dragon_Warrior     13   18
                Midrange_Hunter     2   11
                Miracle_Rogue       2    2
                Tempo_Mage          1    3
                Token_Druid         4    4
                Zoo_Warlock        13   11
Dragon_Warrior  Aggro_Paladin      10    7
                Aggro_Shaman       47   52
                C'Thun_Druid       21   21
...                               ...  ...
Other_Warrior   Other_Paladin      31   49
                Other_Priest       49   46
                Other_Rogue        63   64
                Other_Shaman      202  179
                Other_Warlock     149  180
                Other_Warrior     305  248
                Reno_Warlock        3   11
                Tempo_Mage         26   12
                Tempo_Warrior       5    4
                Token_Druid        12   25
                Zoo_Warlock        34   35
Pirate_Warrior  Dragon_Warrior      5    9
                Midrange_Hunter     2    1
                Midrange_Shaman     2    5
                Miracle_Rogue       2    1
                Tempo_Mage          1    2
                Zoo_Warlock         7    6
Tempo_Warrior   Aggro_Shaman        9    8
                C'Thun_Druid        3    0
                C'Thun_Priest       2    1
                C'Thun_Warrior      7    4
                Dragon_Warrior      6   11
                Midrange_Hunter    14   16
                Midrange_Shaman     5    3
                Miracle_Rogue       2    1
                Other_Warrior       2    2
                Reno_Warlock        2    5
                Tempo_Mage          7    8
                Token_Druid         2    6
                Zoo_Warlock        21   18

[102 rows x 2 columns]
#+end_example

#+BEGIN_SRC ipython :session :file /tmp/image.png :exports both
  dist = []
  for r in zip(stats['turn'], stats['win']):
      dist.extend([r[0]]*r[1])
  sns.distplot(dist)
  sns.plt.show()
#+END_SRC

#+RESULTS:
[[file:/tmp/image.png]]

#+BEGIN_SRC ipython :session :file /tmp/images.png :exports both
  g = sns.JointGrid(x='turn', y='win', data=cards.loc['Fiery War Axe', 'Dragon_Warrior'].reset_index())
  g = g.plot(sns.regplot, sns.distplot)
#+END_SRC

#+RESULTS:
[[file:/tmp/images.png]]
